% !TeX spellcheck = de_DE
% Die erste (unkommentierte) Zeile im Dokument legt immer die
% Dokumentklasse fest
\documentclass{scrreprt} 

% Präambel:
% Einbinen von zusätzlichen Paketen. Falls für eine Datei keine Endung
% explizit angegeben wird, benutzt LaTeX '.tex'. Im Folgenden wird
% also die Datei 'edv_pakete.tex' eingebunden.
\input{edv_pakete}

% Verzeichnisse mit Abbildungen; kann gestrichen werden,
% falls Sie dies schon in edv_pakete.tex definiert haben:
\graphicspath{{Bilder/}, {Bilder/Gitter/}}
\addbibresource{refs.bib}

\usepackage{textcomp}
\usepackage{eurosym}

%\addbibresource{refs.bib} %Hinzufügen einer Literaturdatenbank aus dem angegebenen Verzeichnis

% Titel, Autor und Datum
\title{Monte-Carlo Simulation eines statistischen Modells auf einem Parallelrechner}
\date{Juli 2020}
\author{Christiane Groß}

% Jetzt startet das eigentliche Dokument
\begin{document}
	\maketitle
	
	% Römische Zahlen für die Seitennummern des Inhaltsverzeichnisses
	\pagenumbering{roman}
	
	% Inhaltsverzeichnis kommt hier
	\tableofcontents
	
	\clearpage
	
	% Normale Zahlen für die Seitennummern des Fliesstextes
	\pagenumbering{arabic}
	%Inhalt
	\chapter{Theoretischer Hintergrund}
	\section{Monte-Carlo Simulationen}
	Suche Observablen von komplexen Systemen. Problem: Zustandssumme nicht/nur schwer analytisch bestimmebar. \[Z=\int_{Alle Konfigurationen}\exp(-H/T)\], Observable \[<A>=1/Z\int_{alle Konfigurationen} A\exp(-H/T)\]. Generell: Integral bestimmen, nicht analytisch lösbar.
	Idee: Diskretisiere Itegral, verteile Summe nicht gleichmäßig, sondern summiere bevorzugt über Zustände, die ein höheres Gewicht haben. 
	wie Zustände generieren? Aus Zufallszahlen, nicht deterministisch, Zufallszahlen so verteilt, dass gewichtigere zustände öfter vorkommen. Gehe von jeweils aktuellen zustand aus, schlage eine Veränderung vor, nehme an, wenn Energie kleiner wird, sonst mit Wahrscheinlichkeit $\exp(-\Delta H/T)$. Metropolis-Update, da Zustand aus vorherigem generiert wird, Markovkette.
	Am Anfang \enquote{Thermalisieren} oder Einbrennen nötig, da erst eine Region gefunden werden muss, in der die Zustände gut verteilt sind. Die Daten währen des einbrennens werden nicht benötigt.
	 Quelle: Skript
	
	\section{Das Ising-Modell}
	Simulation eines Ferromagneten: 2D-Gitterförmige Anordnung von Spins, die Werte $\pm1$ annehmen können, in realen Applikationen endliche Länge, in Natur thermodynamischer Limes/unendlich lang.
	\begin{equation}
	H=-J\sum_{<i,j>}s_is_j
	\label{eq:hamiltonianising}
	\end{equation}
	Mit $<i,j>$ alle benachbarten Paare, $J$ in beide Richtungen gleich und konstant.
	
	Das Kontinuumslimes von unendlich vielen Gitterpunkten wird durch Periodische Randbedingungen modelliert.
	
	Kritischer Punkt bei \[\sinh^2\left(\frac{2J}{k_BT}\right) =1\]
	\cite{OnsagerCrystal1}
	
	Eine Messung: Bei jedem Spin wird ein Metropolis-Update durchgeführt.
	
	Akzeptanzrate: Wie viele Spins wurden bei einer Messung umgedreht? Wird bei jedem Punkt gezählt und in eine Variable geschrieben.
	
	Magnetisierung: Betrag der Summe über alle Spins im Gitter, je mehr Spins gleich ausgerichtet sind, desto stärker der nach außen sichtbare Effekt als Magnet.
	
	
	\section{Parallelrechner}
	\subsection{Shared Memory mit OpenMP}
	\subsection{MPI}
	
	
	\chapter{Umsetzung}
	\section{Initialisierung und Thermalisierung}
	Gitter, Hamiltonian, Thermalisierungsschwelle
	
	Gitter mit zwei for-schleifen füllen, Mersenne-Twister, der auf +-1 zugeordnet wird.
	Hamiltonian durch Gitterdurchgang mit zwei Schleifen nach Formel \ref{eq:hamiltonianising}
	
	Sweep: geht gesamtes Gitter durch, führt Metropolis Update durch.
	
	Parallelisiert: Durchgehen in "Schachbrettmuster", erst alle schwarzen und dann alle weißen Punkte, da zum Aktualisieren der schwarzen Punkte nur alle weißen benötigt werden, somit alle Schwarzen gleichzeitig aktualisiert werden können und umgekehrt.
	
	Durchgang mit Schachbrettmuster dauert ca. 25 \% länger, aber beim parallelisieren geht es schon mit zwei Kernen 20 \% schneller. 
	
	Vergleich der Daten zeigt: Im Mittel kommt bei allen methoden dasselbe Ergebnis heraus. \ref{fig:vergleichhamiltoniansweep}
	
	\begin{figure}[htbp]
	\input{Bilder/Vergleichham}
	\label{fig:vergleichhamiltoniansweep}
		\caption{Vergleich der Mittelwerte über 10000 Messungen des Hamiltonians bei verschiedenen Methoden, das Gitter durchzugehen. Laenge=50}
	\end{figure}
	
	Thermalisierung:
	 
	Vergleichen von hamiltonian vor und nach sweep, solange sweeps, bis Energie sich nicht mehr verringert. Bilder?
	Geändert, da Probleme mit Springen bei der Magnetisierung auftauchen: Anfangs Thermalisierung mit vielen sweeps (10000), danach Thermalisierung auf Basis des gitters der vorherigen Temperatur mit (5000) Sweeps
	
	Ausgabe mit x, y Position, Spin in txt datei, mit gnuplot als Heatmap plotten.
	Verhalten: Bei niedrigen Temperaturen nur ein großer, einfarbiger Bezirk, dann bei höheren Temperaturen einige Punkte mit anderer Farbe, bei hohen Temperaturen nur Rauschen.
	
	\begin{figure}
	\begin{minipage}{0.48\textwidth}
		\input{Bilder/Gitter/gitter-laenge0050-t000.tex}
	\end{minipage}
	\begin{minipage}{0.48\textwidth}
		\input{Bilder/Gitter/gitter-laenge0050-t100.tex}
	\end{minipage}
	\begin{minipage}{0.48\textwidth}
		\input{Bilder/Gitter/gitter-laenge0050-t250.tex}
	\end{minipage}
	\caption{Gitter bei verschiedenen Temperaturen}
	\label{fig:gitter}
	\end{figure}
	
	\section{Messungen}
	\subsection{Akzeptanzrate}
	Beim Sweep wird jede Veränderung gezählt, am Ende wird Veränderungen/laenge/laenge in datei geschrieben. Prozentuale Veränderung.
	Parallelisieren: Zwischenvariable für jeden Thread. Bild, erst gering, dann steil steigend, flacht ab, bildet Plateau.
	\begin{figure}
		\input{Bilder/akzeptanzratenaiv.tex}
		\label{fig:akzeptanznaiv}
		\caption{Die Akzeptanzrate bei 10000 Messungen je Temperatur mit Laenge 50}
	\end{figure}
	Bei welchen Temperaturen?
	\subsection{Magnetisierung}
	Magnetisierung= Abs(Summe über alle Spins im Gitter)
	
	Bilder
	
	-Bei kleinen Temperaturen, unterhalb von T ungefähr 0,7, ist die
	 Magnetisierung konstant 1, mit sehr geringen Abweichungen.
	 
	 -Zwischen ca. 0,7 und ca. 2,5 nimmt die Magnetisierung ab, springt jedoch
	 immer wieder zwischen stärkeren und schwächeren Magnetisierungen hin und
	 her. Dies wird erst ab einer gewissen Gitterlänge sichtbar, bei kleineren
	 Gitterlängen (ausprobiert habe ich es mit 10), ist die Abnahme viel weniger
	 sprunghaft. In diesem Bereich ist die Standardabweichung der Messungen recht
	 groß.
	 
	 -Bei größeren Temperaturen, oberhalb von ca. 2,5, ist die Magnetisierung
	 annähernd konstant und fast null. Der relative Fehler ist in diesem Bereich
	 recht groß, jedoch ist der absolute Fehler, genau wie der Messwert, klein.
	 
	 Behoben durch bessere Thermalisierung: bei geringeren Temperaturen konstant 1 mit geringen Fehlern, 
	 um T=2 herum Abfall, steiler, je länger das Gitter ist, mit recht großen Fehlern, bei hohen Temperaturen konstant niedrige Magnetisierung mit größerem Fehler als bei niedriger Temperatur. (Bild)
	 
	 theoretischer Kritischer Punkt für $J=1:\quad T=2,269$
	 Bestimmung: Unstetigkeit in magnetisierung bei kritischem Punkt erwartet, d.h. Pol in der Ableitung. 
	 Mit 2-Punkt-Formel Ableitung bestimmen, Extremum: kritischer Punkt muss zwischen den beiden Nachbarn liegen. Ergebnis für l=128: Kritischer Punkt bei $T=2,295\pm0,015$.
	 	\begin{figure}
	 		\input{Bilder/ableitung.tex}
	 		\label{fig:ableitung}
	 		\caption{Ableitung der Daten aus l=128 mit 2-Punkt-Formel}
	 	\end{figure}
	 	
	 
	 Temperatur durch Autokorrelation, durch bootstrapping mit blocking ausgleichen. 
	 Zuerst Fehler, da Replika falsch verstanden, danach klare Änderung vom Fehler mit l (Bild).
	 
	 Magnetisierung mit Bootstrap: Bild, kleinerer Fehler, Fehler bei Phasenübergang größer als darunter/darüber.
	\begin{figure}
		\input{Bilder/magnetisierungbootstrap-l-128.tex}
		\label{fig:magnetisierungbootstrap-l-128}
		\caption{Die Magnetisierung bei 10000 Messungen je Temperatur mit Laenge 50, Bootstrapping von Daten mit Blocklänge 128}
	\end{figure}
		
	Parallelisieren, indem Replica parallel gezogen werden, jedes Replica in array geschrieben, danach nur Mittelwert und Varianz über Array berechnen.
	Vergleich: Mittelwerte gleich.
	\begin{figure}
		\input{Bilder/vergleichbootstrap-l-128.tex}
		\label{fig:bootstrapparallel-l-128}
		\caption{Die Magnetisierung bei 10000 Messungen je Temperatur mit Laenge 50, Bootstrapping von Daten mit Blocklänge 128, Vergleich von parallel und nicht paralleler Funktion}
	\end{figure}	
	
		
	\chapter{Ergebnisse}
	%Anhang
	\listoffigures
	\listoftables
	
	
	
	\printbibliography[heading=bibintoc]
\end{document}