% !TeX spellcheck = de_DE
% Die erste (unkommentierte) Zeile im Dokument legt immer die
% Dokumentklasse fest
\documentclass{scrreprt} 

% Präambel:
% Einbinen von zusätzlichen Paketen. Falls für eine Datei keine Endung
% explizit angegeben wird, benutzt LaTeX '.tex'. Im Folgenden wird
% also die Datei 'edv_pakete.tex' eingebunden.
\input{edv_pakete}

% Verzeichnisse mit Abbildungen; kann gestrichen werden,
% falls Sie dies schon in edv_pakete.tex definiert haben:
\graphicspath{{Bilder/}, {Bilder/Gitter/}}
\addbibresource{refs.bib}

\usepackage{textcomp}
\usepackage{eurosym}

%\addbibresource{refs.bib} %Hinzufügen einer Literaturdatenbank aus dem angegebenen Verzeichnis

% Titel, Autor und Datum
\title{Monte-Carlo Simulation eines statistischen Modells auf einem Parallelrechner}
\date{Juli 2020}
\author{Christiane Groß}

% Jetzt startet das eigentliche Dokument
\begin{document}
	\maketitle
	
	% Römische Zahlen für die Seitennummern des Inhaltsverzeichnisses
	\pagenumbering{roman}
	
	% Inhaltsverzeichnis kommt hier
	\tableofcontents
	
	\clearpage
	
	% Normale Zahlen für die Seitennummern des Fliesstextes
	\pagenumbering{arabic}
	%Inhalt
	\chapter{Theoretischer Hintergrund}
	\section{Monte-Carlo Simulationen}
	\section{Das Ising-Modell}
	\section{Parallelrechner}
	\subsection{Shared Memory mit OpenMP}
	\subsection{MPI}
	\chapter{Umsetzung}
	\section{Initialisierung und Thermalisierung}
	Gitter, Hamiltonian, Thermalisierungsschwelle
	
	Gitter mit zwei for-schleifen füllen, Mersenne-Twister, der auf +-1 zugeordnet wird.
	Hamiltonian durch Gitterdurchgang mit zwei Schleifen nach Formel $H=-J\sum_{<i,j>}S_iS_j$
	
	Sweep: geht gesamtes Gitter durch, dreht Spin um mit Wahrscheinlichkeit $min\left(1, exp(-\Delta H/T)\right) $
	
	Parallelisiert: Durchgehen in "Schachbrettmuster", erst alle schwarzen und dann alle weißen Punkte, da zum Aktualisieren der schwarzen Punkte nur alle weißen benötigt werden, somit alle Schwarzen gleichzeitig aktualisiert werden können und umgekehrt.
	
	Durchgang mit Schachbrettmuster dauert ca. 25 \% länger, aber beim parallelisieren geht es schon mit zwei Kernen 20 \% schneller. 
	
	Vergleich der Daten zeigt: Im Mittel kommt bei allen methoden dasselbe Ergebnis heraus. \ref{fig:vergleichhamiltoniansweep}
	
	\begin{figure}[htbp]
	\input{Bilder/Vergleichham}
	\label{fig:vergleichhamiltoniansweep}
		\caption{Vergleich der Mittelwerte über 10000 Messungen des Hamiltonians bei verschiedenen Methoden, das Gitter durchzugehen. Laenge=50}
	\end{figure}
	
	Thermalisierung: 
	Vergleichen von hamiltonian vor und nach sweep, solange sweeps, bis Energie sich nicht mehr verringert. Bilder?
	Geändert, da Probleme mit Springen bei der Magnetisierung auftauchen: Anfangs Thermalisierung mit vielen sweeps (10000), danach Thermalisierung auf Basis des gitters der vorherigen Temperatur mit (5000) Sweeps
	
	Ausgabe mit x, y Position, Spin in txt datei, mit gnuplot als Heatmap plotten.
	Verhalten: Bei niedrigen Temperaturen nur ein großer, einfarbiger Bezirk, dann bei höheren Temperaturen einige Punkte mit anderer Farbe, bei hohen Temperaturen nur Rauschen.
	
	\begin{figure}
	\begin{minipage}{0.48\textwidth}
		\input{Bilder/Gitter/gitter-laenge0050-t000.tex}
	\end{minipage}
	\begin{minipage}{0.48\textwidth}
		\input{Bilder/Gitter/gitter-laenge0050-t100.tex}
	\end{minipage}
	\begin{minipage}{0.48\textwidth}
		\input{Bilder/Gitter/gitter-laenge0050-t250.tex}
	\end{minipage}
	\caption{Gitter bei verschiedenen Temperaturen}
	\label{fig:gitter}
	\end{figure}
	
	\section{Messungen}
	\subsection{Akzeptanzrate}
	Beim Sweep wird jede Veränderung gezählt, am Ende wird Veränderungen/laenge/laenge in datei geschrieben.
	Parallelisieren: Zwischenvariable für jeden Thread. Bild, erst gering, dann steil steigend, flacht ab, bildet Plateau.
	\begin{figure}
		\input{Bilder/akzeptanzratenaiv.tex}
		\label{fig:akzeptanznaiv}
		\caption{Die Akzeptanzrate bei 10000 Messungen je Temperatur mit Laenge 50}
	\end{figure}
	Bei welchen Temperaturen?
	\subsection{Magnetisierung}
	Magnetisierung= Abs(Summe über alle Spins im Gitter)
	
	Bilder
	
	-Bei kleinen Temperaturen, unterhalb von T ungefähr 0,7, ist die
	 Magnetisierung konstant 1, mit sehr geringen Abweichungen.
	 
	 -Zwischen ca. 0,7 und ca. 2,5 nimmt die Magnetisierung ab, springt jedoch
	 immer wieder zwischen stärkeren und schwächeren Magnetisierungen hin und
	 her. Dies wird erst ab einer gewissen Gitterlänge sichtbar, bei kleineren
	 Gitterlängen (ausprobiert habe ich es mit 10), ist die Abnahme viel weniger
	 sprunghaft. In diesem Bereich ist die Standardabweichung der Messungen recht
	 groß.
	 
	 -Bei größeren Temperaturen, oberhalb von ca. 2,5, ist die Magnetisierung
	 annähernd konstant und fast null. Der relative Fehler ist in diesem Bereich
	 recht groß, jedoch ist der absolute Fehler, genau wie der Messwert, klein.
	 
	 Behoben durch bessere Thermalisierung: bei geringeren Temperaturen konstant 1 mit geringen Fehlern, 
	 um T=2 herum Abfall, steiler, je länger das Gitter ist, mit recht großen Fehlern, bei hohen Temperaturen konstant niedrige Magnetisierung mit größerem Fehler als bei niedriger Temperatur. (Bild)
	 
	 
	 Temperatur durch Autokorrelation, durch bootstrapping mit blocking ausgleichen. 
	 Zuerst Fehler, da Replika falsch verstanden, danach klare Änderung vom Fehler mit l (Bild).
	 
	 Magnetisierung mit Bootstrap: Bild, kleinerer Fehler, Fehler bei Phasenübergang größer als darunter/darüber.
	\begin{figure}
		\input{Bilder/magnetisierungbootstrap-l-128.tex}
		\label{fig:magnetisierungbootstrap-l-128}
		\caption{Die Magnetisierung bei 10000 Messungen je Temperatur mit Laenge 50, Bootstrapping von Daten mit Blocklänge 128}
	\end{figure}
		
	Parallelisieren, indem Replica parallel gezogen werden, jedes Replica in array geschrieben, danach nur Mittelwert und Varianz über Array berechnen.
	Vergleich: Mittelwerte gleich.
	\begin{figure}
		\input{Bilder/vergleichbootstrap-l-128.tex}
		\label{fig:bootstrapparallel-l-128}
		\caption{Die Magnetisierung bei 10000 Messungen je Temperatur mit Laenge 50, Bootstrapping von Daten mit Blocklänge 128, Vergleich von parallel und nicht paralleler Funktion}
	\end{figure}	
	
		
	\chapter{Ergebnisse}
	%Anhang
	\listoffigures
	\listoftables
	
	
	
	\printbibliography[heading=bibintoc]
\end{document}